#!/bin/bash -l
#SBATCH -N 1
#SBATCH -t 00:30:00
#SBATCH -q debug
#SBATCH -L SCRATCH
#SBATCH -C haswell
#SBATCH -o 400fs_closed.log
#SBATCH --account=lcls

#export OMP_DISPLAY_ENV=true 
#export OMP_DISPLAY_AFFINITY=true
#export OMP_NUM_THREADS=48

module load python
conda activate SRWmp
srun -n 1 python HHLM_HRM_variable.py

Warning: Python module not loaded, you already have Python loaded via conda init
/global/homes/n/nanw0321/.conda/envs/SRWmp/lib/python3.9/site-packages/scipy/optimize/minpack.py:828: OptimizeWarning: Covariance of the parameters could not be estimated
  warnings.warn('Covariance of the parameters could not be estimated',
/global/u2/n/nanw0321/DXS_optics/Loop/Diagnostic_functions.py:321: RuntimeWarning: divide by zero encountered in log
  intensity_f = np.log(intensity_f)
/global/u2/n/nanw0321/DXS_optics/Loop/HHLM_HRM_variable.py:1195: UserWarning: Attempting to set identical bottom == top == 0.0 results in singular transformations; automatically expanding.
  if if_slice != 1: plt.ylim([ystart, yfin])
/global/u2/n/nanw0321/DXS_optics/Loop/Diagnostic_functions.py:229: RuntimeWarning: divide by zero encountered in log
  img = np.log(img)
arguments: [400.0, 0.0, 0.0, 0.0, 0.0, 0.0]
error type: , error value: 
if_log 1, if_close 1, if_slice 1
nx, ny, nz: [256, 8, 400]
x resolution/range: 15.62/ 4000.0um
y resolution/range: 500.0/ 4000.0um
time resolution/range: 40.0/ 16000.0fs
energy resolution/range: 0.25/ 100.0meV
HHLM var_param
 nv: 
[[-0.999  0.    -0.051]
 [ 0.732  0.    -0.681]
 [-0.732  0.    -0.681]
 [ 0.8    0.    -0.601]]
 tv: 
[[-0.051  0.     0.999]
 [ 0.681  0.     0.732]
 [-0.681  0.     0.732]
 [ 0.601  0.     0.8  ]]
 incident angle: 
[0.051 0.749 0.749 0.644]

HRM var_param
 nv: 
[[-0.732  0.    -0.681]
 [ 0.302  0.    -0.953]
 [ 0.732  0.    -0.681]
 [-0.973  0.    -0.232]]
 tv: 
[[-0.681  0.     0.732]
 [ 0.953  0.     0.302]
 [ 0.681  0.     0.732]
 [-0.232  0.     0.973]]
 incident angle: 
[0.749 1.264 0.749 0.234]

HHLM scaling
 b factor: 11.83
 t stretching: 52300.88fs
 x scale: 12, z scale: 3.0

HRM scaling
 b factor: 4.11
 t stretching: 38515.46fs
 x scale: 4, z scale: 2.0

directory created: output/
directory created: output/Loop/
directory created: output/Loop/400.0fs/
directory created: output/Loop/400.0fs/16000.0fs_100.0meV/
256 8 400
Gaussian beam electric field calculation ... completed (lasted 0.031 s)
Extracting intensity and saving it to a file ... completed (lasted 0.519 s)
plotting input
del_t*del_E/h: 0.86497
plot lasted 3.08s

Propagating through CRL0: Optical Element Setup: CRL Focal Length: 290.0 m
done in 0.981 s

plotting after CRL0
del_t*del_E/h: 0.86516
plot lasted 2.89s

Resizing in frequency domain: done in 0.448 s
Propagating through HHLM1: done in 3.606 s
plotting after HHLM1
Fit failed. Using second moment for width.
del_t*del_E/h: 20.44516
plot lasted 21.76s

Propagating through HHLM2: done in 4.216 s
plotting after HHLM2
Fit failed. Using second moment for width.
del_t*del_E/h: 20.44243
plot lasted 26.13s

Propagating through HHLM3: done in 3.042 s
plotting after HHLM3
Fit failed. Using second moment for width.
del_t*del_E/h: 20.45005
plot lasted 23.8s

Propagating through HHLM4: done in 2.404 s
plotting after HHLM4
Fit failed. Using second moment for width.
del_t*del_E/h: 0.85861
plot lasted 20.78s

Propagating through CC1: done in 6.856 s
plotting after C2
Fit failed. Using second moment for width.
del_t*del_E/h: 3.78681
plot lasted 26.42s

Propagating to focus: Optical Element Setup: CRL Focal Length: 10.0 m
done in 2.982 s
Propagating through slit: done in 0.24 s
plotting focus, closed
Fit failed. Using second moment for width.
del_t*del_E/h: 1.70005
plot lasted 15.86s

Propagating to CC2: Optical Element Setup: CRL Focal Length: 10.0 m
done in 7.06 s
plotting before C3, closed
Fit failed. Using second moment for width.
del_t*del_E/h: 31.25552
plot lasted 20.06s

Propagating through CC2: done in 6.206 s
plotting output, closed
Fit failed. Using second moment for width.
Fit failed. Using second moment for width.
del_t*del_E/h cannot be calculated
plot lasted 15.15s



everything lasted: 214.67s
