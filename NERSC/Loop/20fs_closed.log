#!/bin/bash -l
#SBATCH -N 1
#SBATCH -t 02:00:00
#SBATCH -q regular
#SBATCH -L SCRATCH
#SBATCH -C haswell
#SBATCH -o 20fs_closed.log
#SBATCH --account=lcls

export OMP_NUM_THREADS=48
export OMP_DISPLAY_ENV=true 
export OMP_DISPLAY_AFFINITY=true

module load python
conda activate SRWmp
srun -n 1 python HHLM_HRM_variable_close.py

Warning: Python module not loaded, you already have Python loaded via conda init

OPENMP DISPLAY ENVIRONMENT BEGIN
  _OPENMP = '201511'
  OMP_DYNAMIC = 'FALSE'
  OMP_NESTED = 'FALSE'
  OMP_NUM_THREADS = '48'
  OMP_SCHEDULE = 'DYNAMIC'
  OMP_PROC_BIND = 'FALSE'
  OMP_PLACES = ''
  OMP_STACKSIZE = '0'
  OMP_WAIT_POLICY = 'PASSIVE'
  OMP_THREAD_LIMIT = '4294967295'
  OMP_MAX_ACTIVE_LEVELS = '2147483647'
  OMP_CANCELLATION = 'FALSE'
  OMP_DEFAULT_DEVICE = '0'
  OMP_MAX_TASK_PRIORITY = '0'
  OMP_DISPLAY_AFFINITY = 'TRUE'
  OMP_AFFINITY_FORMAT = 'level %L thread %i affinity %A'
OPENMP DISPLAY ENVIRONMENT END
level 1 thread 0x2aaaaab34780 affinity 0-63
level 1 thread 0x2aab17c2d700 affinity 0-63
level 1 thread 0x2aab17e2e700 affinity 0-63
level 1 thread 0x2aab1802f700 affinity 0-63
level 1 thread 0x2aab18230700 affinity 0-63
level 1 thread 0x2aab18431700 affinity 0-63
level 1 thread 0x2aab18632700 affinity 0-63
level 1 thread 0x2aab18833700 affinity 0-63
level 1 thread 0x2aab18a34700 affinity 0-63
level 1 thread 0x2aab18c35700 affinity 0-63
level 1 thread 0x2aab18e36700 affinity 0-63
level 1 thread 0x2aab19037700 affinity 0-63
level 1 thread 0x2aab19238700 affinity 0-63
level 1 thread 0x2aab19439700 affinity 0-63
level 1 thread 0x2aab1963a700 affinity 0-63
level 1 thread 0x2aab1983b700 affinity 0-63
level 1 thread 0x2aab19a3c700 affinity 0-63
level 1 thread 0x2aab19c3d700 affinity 0-63
level 1 thread 0x2aab19e3e700 affinity 0-63
level 1 thread 0x2aab1a03f700 affinity 0-63
level 1 thread 0x2aab1a240700 affinity 0-63
level 1 thread 0x2aab1a441700 affinity 0-63
level 1 thread 0x2aab1a642700 affinity 0-63
level 1 thread 0x2aab1a843700 affinity 0-63
level 1 thread 0x2aab1aa44700 affinity 0-63
level 1 thread 0x2aab1ac45700 affinity 0-63
level 1 thread 0x2aab1ae46700 affinity 0-63
level 1 thread 0x2aab1b047700 affinity 0-63
level 1 thread 0x2aab1b248700 affinity 0-63
level 1 thread 0x2aab1b449700 affinity 0-63
level 1 thread 0x2aab1b64a700 affinity 0-63
level 1 thread 0x2aab1b84b700 affinity 0-63
level 1 thread 0x2aab1f930700 affinity 0-63
level 1 thread 0x2aab1fb31700 affinity 0-63
level 1 thread 0x2aab1fd32700 affinity 0-63
level 1 thread 0x2aab1ff33700 affinity 0-63
level 1 thread 0x2aab20134700 affinity 0-63
level 1 thread 0x2aab20335700 affinity 0-63
level 1 thread 0x2aab20536700 affinity 0-63
level 1 thread 0x2aab20737700 affinity 0-63
level 1 thread 0x2aab20938700 affinity 0-63
level 1 thread 0x2aab20b39700 affinity 0-63
level 1 thread 0x2aab20d3a700 affinity 0-63
level 1 thread 0x2aab20f3b700 affinity 0-63
level 1 thread 0x2aab2113c700 affinity 0-63
level 1 thread 0x2aab2133d700 affinity 0-63
level 1 thread 0x2aab2153e700 affinity 0-63
level 1 thread 0x2aab2173f700 affinity 0-63
/global/homes/n/nanw0321/.conda/envs/SRWmp/lib/python3.9/site-packages/scipy/optimize/minpack.py:828: OptimizeWarning: Covariance of the parameters could not be estimated
  warnings.warn('Covariance of the parameters could not be estimated',
/global/u2/n/nanw0321/DXS_optics/Loop/Diagnostic_functions.py:321: RuntimeWarning: divide by zero encountered in log
  intensity_f = np.log(intensity_f)
/global/u2/n/nanw0321/DXS_optics/Loop/HHLM_HRM_variable_close.py:1195: UserWarning: Attempting to set identical bottom == top == 0.0 results in singular transformations; automatically expanding.
  if if_slice != 1: plt.ylim([ystart, yfin])
/global/u2/n/nanw0321/DXS_optics/Loop/HHLM_HRM_variable_close.py:1195: UserWarning: Attempting to set identical bottom == top == -4.3368086899420177e-13 results in singular transformations; automatically expanding.
  if if_slice != 1: plt.ylim([ystart, yfin])
/global/u2/n/nanw0321/DXS_optics/Loop/Diagnostic_functions.py:229: RuntimeWarning: divide by zero encountered in log
  img = np.log(img)
/global/u2/n/nanw0321/DXS_optics/Loop/HHLM_HRM_variable_close.py:1176: RankWarning: Polyfit may be poorly conditioned
  tilt = round(fit_pulsefront_tilt(_wfr, dim='x'),2)     # [fs/um]
/global/u2/n/nanw0321/DXS_optics/Loop/HHLM_HRM_variable_close.py:1194: UserWarning: Attempting to set identical left == right == 15.2587890625 results in singular transformations; automatically expanding.
  plt.title(title_space); plt.axis('tight'); plt.xlim([xstart, xfin])
/global/u2/n/nanw0321/DXS_optics/Loop/HHLM_HRM_variable_close.py:1199: UserWarning: Attempting to set identical bottom == top == 15.2587890625 results in singular transformations; automatically expanding.
  plt.title(title_time); plt.xlim([tstart, tfin]); plt.ylim([xstart, xfin])
/global/u2/n/nanw0321/DXS_optics/Loop/HHLM_HRM_variable_close.py:1203: UserWarning: Attempting to set identical left == right == 15.2587890625 results in singular transformations; automatically expanding.
  plt.title(title_energy); plt.xlim([xstart, xfin]); plt.ylim([Estart, Efin])
arguments: [20.0, 0.0, 0.0, 0.0, 0.0, 0.0]
error type: , error value: 
if_log 1, if_close 1, if_slice 1
nx, ny, nz: [256, 8, 2000]
x resolution/range: 15.62/ 4000.0um
y resolution/range: 500.0/ 4000.0um
time resolution/range: 2.0/ 4000.0fs
energy resolution/range: 1.0/ 2000.0meV
HHLM var_param
 nv: 
[[-0.999  0.    -0.051]
 [ 0.732  0.    -0.681]
 [-0.732  0.    -0.681]
 [ 0.8    0.    -0.601]]
 tv: 
[[-0.051  0.     0.999]
 [ 0.681  0.     0.732]
 [-0.681  0.     0.732]
 [ 0.601  0.     0.8  ]]
 incident angle: 
[0.051 0.749 0.749 0.644]

HRM var_param
 nv: 
[[-0.732  0.    -0.681]
 [ 0.302  0.    -0.953]
 [ 0.732  0.    -0.681]
 [-0.973  0.    -0.232]]
 tv: 
[[-0.681  0.     0.732]
 [ 0.953  0.     0.302]
 [ 0.681  0.     0.732]
 [-0.232  0.     0.973]]
 incident angle: 
[0.749 1.264 0.749 0.234]

HHLM scaling
 b factor: 11.83
 t stretching: 52300.88fs
 x scale: 12, z scale: 13.0

HRM scaling
 b factor: 4.11
 t stretching: 38515.46fs
 x scale: 4, z scale: 10.0

directory created: output/
directory created: output/Loop/
directory created: output/Loop/20.0fs/
directory created: output/Loop/20.0fs/4000.0fs_2000.0meV/
256 8 2000
Gaussian beam electric field calculation ... completed (lasted 0.099 s)
Extracting intensity and saving it to a file ... completed (lasted 1.647 s)
plotting input
del_t*del_E/h: 0.83034
plot lasted 4.15s

Propagating through CRL0: Optical Element Setup: CRL Focal Length: 290.0 m
done in 1.056 s

plotting after CRL0
del_t*del_E/h: 0.83034
plot lasted 4.05s

Resizing in frequency domain: done in 3.24 s
Propagating through HHLM1: done in 54.285 s
plotting after HHLM1
Fit failed. Using second moment for width.
del_t*del_E/h: 404.4007
plot lasted 426.89s

Propagating through HHLM2: done in 106.431 s
plotting after HHLM2
Fit failed. Using second moment for width.
del_t*del_E/h: 395.09193
plot lasted 512.71s

Propagating through HHLM3: done in 86.538 s
plotting after HHLM3
Fit failed. Using second moment for width.
del_t*del_E/h: 388.98542
plot lasted 444.71s

Propagating through HHLM4: done in 69.663 s
plotting after HHLM4
Fit failed. Using second moment for width.
del_t*del_E/h: 1.16501
plot lasted 330.29s

Propagating through CC1: done in 192.295 s
plotting after C2
Fit failed. Using second moment for width.
del_t*del_E/h: 34.66413
plot lasted 504.63s

Propagating to focus: Optical Element Setup: CRL Focal Length: 10.0 m
done in 64.991 s
Propagating through slit: done in 6.865 s
plotting focus, closed
Fit failed. Using second moment for width.
del_t*del_E/h: 1.42767
plot lasted 277.99s

Propagating to CC2: Optical Element Setup: CRL Focal Length: 10.0 m
done in 139.729 s
plotting before C3, closed
Fit failed. Using second moment for width.
Fit failed. Using second moment for width.
del_t*del_E/h: 0.86772
plot lasted 344.41s

Propagating through CC2: done in 162.104 s
plotting output, closed
Fit failed. Using second moment for width.
Fit failed. Using second moment for width.
del_t*del_E/h cannot be calculated
plot lasted 279.88s



everything lasted: 4019.53s
